SELECT * FROM REPORT_ACTION_LOG WHERE ACTIONTYPE = 5 AND ACTIONDATE > '14 Feb 2025' AND LOGINNAME = 'WebApp'

SELECT CLIENT_REF_NO, * FROM CUSTOMER_INSURED_PARTY WHERE EMAIL = 'huw.tester04122024@gmx.com'


SELECT * FROM CUSTOMER_POLICY_DETAILS WHERE POLICYNUMBER = 'ARCCL1003088'


SELECT * FROM CUSTOMER_POLICY_LINK WHERE POLICY_DETAILS_ID = 'CA6C4F66D42845A89ABD619B45CDF978'


UPDATE CUSTOMER_POLICY_LINK SET INSURED_PARTY_ID = '2842A136A4A148758D3F9F1212644E1A' -- Huw Watkins WATK/H/3261714
,INSURED_PARTY_HISTORY_ID = 1
WHERE POLICY_DETAILS_ID = 'FD92079EBED14B86935610C1A1C2E092'


DECLARE	@InsuredPartyIDs varchar(MAX)
DECLARE @AgentIDs varchar(MAX)
DECLARE @PolicyStatusIDs varchar(MAX)
SET @InsuredPartyIDs = '2842A136A4A148758D3F9F1212644E1A'
SET @AgentIDs = 'E2F376B621E14C1FB532CED74C7EDCE1,5208F39A498E4706A91BEEC84ED25686' -- Constructaquote, Constructaquote.com
--SET @PolicyStatusIDs = '3AJPUL66,3AJPUL60,3AJPUL67,3AU9IQ25,3AJPUL68,3AJPUL69,3AJPUL75,3AJPUL76,3AJPUL77,3AJPUL79,3F9246U1' -- Policy, Internet Quote, Prospect, Incomplete, Automatic Decline, Manual Decline, Automatic Refer, Manual Refer, Client Decline, Renewal Invited, Renewal Pending
SET @PolicyStatusIDs = '3AJPUL79,3EN12JM3' -- Renewal Invited, Alternative Quote
EXEC [Moorhouse].[uspGetMultipleCustomerQuotesPolicies] @InsuredPartyIDs, @AgentIDs, @PolicyStatusIDs


DECLARE	@InsuredPartyIDs varchar(MAX)
DECLARE @AgentIDs varchar(MAX)
DECLARE @PolicyStatusIDs varchar(MAX)
DECLARE @PolicyID varchar(MAX)
DECLARE @PolicyHID int
SET @InsuredPartyIDs = '2842A136A4A148758D3F9F1212644E1A'
SET @AgentIDs = 'E2F376B621E14C1FB532CED74C7EDCE1,5208F39A498E4706A91BEEC84ED25686' -- Constructaquote, Constructaquote.com
SET @PolicyStatusIDs = '3AJPUL66,3AJPUL60,3AJPUL67,3AU9IQ25,3AJPUL68,3AJPUL69,3AJPUL75,3AJPUL76,3AJPUL77,3AJPUL79,3F9246U1' -- Policy, Internet Quote, Prospect, Incomplete, Automatic Decline, Manual Decline, Automatic Refer, Manual Refer, Client Decline, Renewal Invited, Renewal Pending
SET @PolicyID = 'ARCCL1003088'
SET @PolicyHID = 2
EXEC [Moorhouse].[uspGetMultipleCustomerQuotesPoliciesByPolicyId] @InsuredPartyIDs, @AgentIDs, @PolicyStatusIDs, @PolicyID, @PolicyHID




-- Change top 10 renewal invites in UAT to Huw's account:
-- ------------------------------------------------------

SELECT TOP 10 CPD.POLICY_DETAILS_ID, CPD.POLICYNUMBER, CPD.POLICYSTARTDATE, CPD.POLICYENDDATE
FROM CUSTOMER_POLICY_DETAILS CPD
INNER JOIN CUSTOMER_POLICY_LINK CPL ON CPD.POLICY_DETAILS_ID = CPL.POLICY_DETAILS_ID AND CPD.HISTORY_ID = CPL.POLICY_DETAILS_HISTORY_ID
WHERE POLICY_STATUS_ID = '3AJPUL79' -- Renewal invite
AND POLICYSTARTDATE > GETDATE()
AND INSURED_PARTY_ID <> '2842A136A4A148758D3F9F1212644E1A' -- Huw Watkins WATK/H/3261714
ORDER BY POLICYENDDATE

-- Examples with an alternative quote:
SELECT TOP 10 CPD.POLICY_DETAILS_ID, CPD.POLICYNUMBER, CPD.POLICYSTARTDATE, CPD.POLICYENDDATE
FROM CUSTOMER_POLICY_DETAILS CPD
INNER JOIN CUSTOMER_POLICY_LINK CPL ON CPD.POLICY_DETAILS_ID = CPL.POLICY_DETAILS_ID AND CPD.HISTORY_ID = CPL.POLICY_DETAILS_HISTORY_ID
WHERE POLICY_STATUS_ID = '3AJPUL79' -- Renewal invite
AND POLICYSTARTDATE > GETDATE()
AND INSURED_PARTY_ID <> '2842A136A4A148758D3F9F1212644E1A' -- Huw Watkins WATK/H/3261714
AND EXISTS (SELECT 1 FROM CUSTOMER_POLICY_DETAILS WHERE POLICY_DETAILS_ID = CPD.POLICY_DETAILS_ID AND HISTORY_ID > CPD.HISTORY_ID
			AND POLICY_STATUS_ID = '3EN12JM3') -- Alternative quote
ORDER BY POLICYENDDATE


UPDATE CUSTOMER_POLICY_LINK SET INSURED_PARTY_ID = '2842A136A4A148758D3F9F1212644E1A' -- Huw Watkins WATK/H/3261714
,INSURED_PARTY_HISTORY_ID = 1
WHERE POLICY_DETAILS_ID IN ('3463C4206D8E46BD91015B8F19F57F3B'
,'3832D82891E348E298EC4CA399C7FF48'
,'BCB01EE1F5F24754BA751EEF9B9EBEA1'
,'E7B1394BA1554384B43E08B75AF2D20A'
,'07B0928BF153456DBCFB57202F1ADF68'
,'48DA0A2887FD4D4D96EF68F4FD5299FC'
,'5FC443CEF1E447B886EDCD24FB986EFD'
,'B5E228315FBA48C2AB0716D553DDEB6A'
,'CA6C4F66D42845A89ABD619B45CDF978'
,'6118983B4B0C4F16B6334491D09B1DCB'
)


